"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ap = ap;
exports.apFirst = apFirst;
exports.apS = apS;
exports.apSecond = apSecond;
exports.getApplySemigroup = getApplySemigroup;
exports.sequenceS = sequenceS;
exports.sequenceT = sequenceT;

var _function = require("./function");

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function ap(F, G) {
  return function (fa) {
    return function (fab) {
      return F.ap(F.map(fab, function (gab) {
        return function (ga) {
          return G.ap(gab, ga);
        };
      }), fa);
    };
  };
}
/**
 * @category combinators
 * @since 2.10.0
 */


function apFirst(A) {
  return function (second) {
    return function (first) {
      return A.ap(A.map(first, function (a) {
        return function () {
          return a;
        };
      }), second);
    };
  };
}
/**
 * @category combinators
 * @since 2.10.0
 */


function apSecond(A) {
  return function (second) {
    return function (first) {
      return A.ap(A.map(first, function () {
        return function (b) {
          return b;
        };
      }), second);
    };
  };
}
/**
 * @category combinators
 * @since 2.10.0
 */


function apS(F) {
  return function (name, fb) {
    return function (fa) {
      return F.ap(F.map(fa, function (a) {
        return function (b) {
          return Object.assign({}, a, _defineProperty({}, name, b));
        };
      }), fb);
    };
  };
} // -------------------------------------------------------------------------------------
// utils
// -------------------------------------------------------------------------------------

/**
 * Lift a semigroup into 'F', the inner values are concatenated using the provided `Semigroup`.
 *
 * @since 2.10.0
 */


function getApplySemigroup(F) {
  return function (S) {
    return {
      concat: function concat(first, second) {
        return F.ap(F.map(first, function (x) {
          return function (y) {
            return S.concat(x, y);
          };
        }), second);
      }
    };
  };
}

function curried(f, n, acc) {
  return function (x) {
    var combined = Array(acc.length + 1);

    for (var i = 0; i < acc.length; i++) {
      combined[i] = acc[i];
    }

    combined[acc.length] = x;
    return n === 0 ? f.apply(null, combined) : curried(f, n - 1, combined);
  };
}

var tupleConstructors = {
  1: function _(a) {
    return [a];
  },
  2: function _(a) {
    return function (b) {
      return [a, b];
    };
  },
  3: function _(a) {
    return function (b) {
      return function (c) {
        return [a, b, c];
      };
    };
  },
  4: function _(a) {
    return function (b) {
      return function (c) {
        return function (d) {
          return [a, b, c, d];
        };
      };
    };
  },
  5: function _(a) {
    return function (b) {
      return function (c) {
        return function (d) {
          return function (e) {
            return [a, b, c, d, e];
          };
        };
      };
    };
  }
};

function getTupleConstructor(len) {
  if (!tupleConstructors.hasOwnProperty(len)) {
    tupleConstructors[len] = curried(_function.tuple, len - 1, []);
  }

  return tupleConstructors[len];
}
/**
 * Tuple sequencing, i.e., take a tuple of monadic actions and does them from left-to-right, returning the resulting tuple.
 *
 * @example
 * import { sequenceT } from 'fp-ts/Apply'
 * import * as O from 'fp-ts/Option'
 *
 * const sequenceTOption = sequenceT(O.Apply)
 * assert.deepStrictEqual(sequenceTOption(O.some(1)), O.some([1]))
 * assert.deepStrictEqual(sequenceTOption(O.some(1), O.some('2')), O.some([1, '2']))
 * assert.deepStrictEqual(sequenceTOption(O.some(1), O.some('2'), O.none), O.none)
 *
 * @since 2.0.0
 */


function sequenceT(F) {
  return function () {
    var len = arguments.length;
    var f = getTupleConstructor(len);
    var fas = F.map(arguments.length <= 0 ? undefined : arguments[0], f);

    for (var i = 1; i < len; i++) {
      fas = F.ap(fas, i < 0 || arguments.length <= i ? undefined : arguments[i]);
    }

    return fas;
  };
}

function getRecordConstructor(keys) {
  var len = keys.length;

  switch (len) {
    case 1:
      return function (a) {
        return _defineProperty({}, keys[0], a);
      };

    case 2:
      return function (a) {
        return function (b) {
          var _ref2;

          return _ref2 = {}, _defineProperty(_ref2, keys[0], a), _defineProperty(_ref2, keys[1], b), _ref2;
        };
      };

    case 3:
      return function (a) {
        return function (b) {
          return function (c) {
            var _ref3;

            return _ref3 = {}, _defineProperty(_ref3, keys[0], a), _defineProperty(_ref3, keys[1], b), _defineProperty(_ref3, keys[2], c), _ref3;
          };
        };
      };

    case 4:
      return function (a) {
        return function (b) {
          return function (c) {
            return function (d) {
              var _ref4;

              return _ref4 = {}, _defineProperty(_ref4, keys[0], a), _defineProperty(_ref4, keys[1], b), _defineProperty(_ref4, keys[2], c), _defineProperty(_ref4, keys[3], d), _ref4;
            };
          };
        };
      };

    case 5:
      return function (a) {
        return function (b) {
          return function (c) {
            return function (d) {
              return function (e) {
                var _ref5;

                return _ref5 = {}, _defineProperty(_ref5, keys[0], a), _defineProperty(_ref5, keys[1], b), _defineProperty(_ref5, keys[2], c), _defineProperty(_ref5, keys[3], d), _defineProperty(_ref5, keys[4], e), _ref5;
              };
            };
          };
        };
      };

    default:
      return curried(function () {
        var r = {};

        for (var i = 0; i < len; i++) {
          r[keys[i]] = i < 0 || arguments.length <= i ? undefined : arguments[i];
        }

        return r;
      }, len - 1, []);
  }
}
/**
 * Like `Apply.sequenceT` but works with structs instead of tuples.
 *
 * @example
 * import * as E from 'fp-ts/Either'
 * import { sequenceS } from 'fp-ts/Apply'
 *
 * const ado = sequenceS(E.Apply)
 *
 * assert.deepStrictEqual(
 *   ado({
 *     a: E.right(1),
 *     b: E.right(true)
 *   }),
 *   E.right({ a: 1, b: true })
 * )
 * assert.deepStrictEqual(
 *   ado({
 *     a: E.right(1),
 *     b: E.left('error')
 *   }),
 *   E.left('error')
 * )
 *
 * @since 2.0.0
 */


function sequenceS(F) {
  return function (r) {
    var keys = Object.keys(r);
    var len = keys.length;
    var f = getRecordConstructor(keys);
    var fr = F.map(r[keys[0]], f);

    for (var i = 1; i < len; i++) {
      fr = F.ap(fr, r[keys[i]]);
    }

    return fr;
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9mcC10cy9BcHBseS50cyJdLCJuYW1lcyI6WyJhcCIsIkYiLCJHIiwiZmEiLCJmYWIiLCJtYXAiLCJnYWIiLCJnYSIsImFwRmlyc3QiLCJBIiwic2Vjb25kIiwiZmlyc3QiLCJhIiwiYXBTZWNvbmQiLCJiIiwiYXBTIiwibmFtZSIsImZiIiwiT2JqZWN0IiwiYXNzaWduIiwiZ2V0QXBwbHlTZW1pZ3JvdXAiLCJTIiwiY29uY2F0IiwieCIsInkiLCJjdXJyaWVkIiwiZiIsIm4iLCJhY2MiLCJjb21iaW5lZCIsIkFycmF5IiwibGVuZ3RoIiwiaSIsImFwcGx5IiwidHVwbGVDb25zdHJ1Y3RvcnMiLCJjIiwiZCIsImUiLCJnZXRUdXBsZUNvbnN0cnVjdG9yIiwibGVuIiwiaGFzT3duUHJvcGVydHkiLCJ0dXBsZSIsInNlcXVlbmNlVCIsImZhcyIsImdldFJlY29yZENvbnN0cnVjdG9yIiwia2V5cyIsInIiLCJzZXF1ZW5jZVMiLCJmciJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQXVDQTs7OztBQW1HTyxTQUFTQSxFQUFULENBQ0xDLENBREssRUFFTEMsQ0FGSyxFQUdxRjtBQUMxRixTQUFPLFVBQUlDLEVBQUo7QUFBQSxXQUE4QixVQUFJQyxHQUFKO0FBQUEsYUFDbkNILENBQUMsQ0FBQ0QsRUFBRixDQUNFQyxDQUFDLENBQUNJLEdBQUYsQ0FBTUQsR0FBTixFQUFXLFVBQUNFLEdBQUQ7QUFBQSxlQUFTLFVBQUNDLEVBQUQ7QUFBQSxpQkFBbUJMLENBQUMsQ0FBQ0YsRUFBRixDQUFLTSxHQUFMLEVBQVVDLEVBQVYsQ0FBbkI7QUFBQSxTQUFUO0FBQUEsT0FBWCxDQURGLEVBRUVKLEVBRkYsQ0FEbUM7QUFBQSxLQUE5QjtBQUFBLEdBQVA7QUFLRDtBQUVEO0FBQ0E7QUFDQTtBQUNBOzs7QUFrQk8sU0FBU0ssT0FBVCxDQUFvQkMsQ0FBcEIsRUFBK0Y7QUFDcEcsU0FBTyxVQUFDQyxNQUFEO0FBQUEsV0FBWSxVQUFDQyxLQUFEO0FBQUEs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QUFDLENBQUNELEVBQUYsQ0FBS2dELEVBQUwsRUFBU0YsQ0FBQyxDQUFDRCxJQUFJLENBQUNiLENBQUQsQ0FBTCxDQUFWLENBQUw7QUFDRDs7QUFDRCxXQUFPZ0IsRUFBUDtBQUNELEdBVEQ7QUFVRCIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVGhlIGBBcHBseWAgY2xhc3MgcHJvdmlkZXMgdGhlIGBhcGAgd2hpY2ggaXMgdXNlZCB0byBhcHBseSBhIGZ1bmN0aW9uIHRvIGFuIGFyZ3VtZW50IHVuZGVyIGEgdHlwZSBjb25zdHJ1Y3Rvci5cbiAqXG4gKiBgQXBwbHlgIGNhbiBiZSB1c2VkIHRvIGxpZnQgZnVuY3Rpb25zIG9mIHR3byBvciBtb3JlIGFyZ3VtZW50cyB0byB3b3JrIG9uIHZhbHVlcyB3cmFwcGVkIHdpdGggdGhlIHR5cGUgY29uc3RydWN0b3JcbiAqIGBmYC5cbiAqXG4gKiBJbnN0YW5jZXMgbXVzdCBzYXRpc2Z5IHRoZSBmb2xsb3dpbmcgbGF3IGluIGFkZGl0aW9uIHRvIHRoZSBgRnVuY3RvcmAgbGF3czpcbiAqXG4gKiAxLiBBc3NvY2lhdGl2ZSBjb21wb3NpdGlvbjogYEYuYXAoRi5hcChGLm1hcChmYmMsIGJjID0+IGFiID0+IGEgPT4gYmMoYWIoYSkpKSwgZmFiKSwgZmEpIDwtPiBGLmFwKGZiYywgRi5hcChmYWIsIGZhKSlgXG4gKlxuICogRm9ybWFsbHksIGBBcHBseWAgcmVwcmVzZW50cyBhIHN0cm9uZyBsYXggc2VtaS1tb25vaWRhbCBlbmRvZnVuY3Rvci5cbiAqXG4gKiBAZXhhbXBsZVxuICogaW1wb3J0ICogYXMgTyBmcm9tICdmcC10cy9PcHRpb24nXG4gKiBpbXBvcnQgeyBwaXBlIH0gZnJvbSAnZnAtdHMvZnVuY3Rpb24nXG4gKlxuICogY29uc3QgZiA9IChhOiBzdHJpbmcpID0+IChiOiBudW1iZXIpID0+IChjOiBib29sZWFuKSA9PiBhICsgU3RyaW5nKGIpICsgU3RyaW5nKGMpXG4gKiBjb25zdCBmYTogTy5PcHRpb248c3RyaW5nPiA9IE8uc29tZSgncycpXG4gKiBjb25zdCBmYjogTy5PcHRpb248bnVtYmVyPiA9IE8uc29tZSgxKVxuICogY29uc3QgZmM6IE8uT3B0aW9uPGJvb2xlYW4+ID0gTy5zb21lKHRydWUpXG4gKlxuICogYXNzZXJ0LmRlZXBTdHJpY3RFcXVhbChcbiAqICAgcGlwZShcbiAqICAgICAvLyBsaWZ0IGEgZnVuY3Rpb25cbiAqICAgICBPLnNvbWUoZiksXG4gKiAgICAgLy8gYXBwbHkgdGhlIGZpcnN0IGFyZ3VtZW50XG4gKiAgICAgTy5hcChmYSksXG4gKiAgICAgLy8gYXBwbHkgdGhlIHNlY29uZCBhcmd1bWVudFxuICogICAgIE8uYXAoZmIpLFxuICogICAgIC8vIGFwcGx5IHRoZSB0aGlyZCBhcmd1bWVudFxuICogICAgIE8uYXAoZmMpXG4gKiAgICksXG4gKiAgIE8uc29tZSgnczF0cnVlJylcbiAqIClcbiAqXG4gKiBAc2luY2UgMi4wLjBcbiAqL1xuaW1wb3J0IHsgRnVuY3RvciwgRnVuY3RvcjEsIEZ1bmN0b3IyLCBGdW5jdG9yMkMsIEZ1bmN0b3IzLCBGdW5jdG9yNCwgRnVuY3RvcjNDIH0gZnJvbSAnLi9GdW5jdG9yJ1xuaW1wb3J0IHsgSEtULCBLaW5kLCBLaW5kMiwgS2luZDMsIEtpbmQ0LCBVUklTLCBVUklTMiwgVVJJUzMsIFVSSVM0IH0gZnJvbSAnLi9IS1QnXG5pbXBvcnQgeyB0dXBsZSB9IGZyb20gJy4vZnVuY3Rpb24nXG5pbXBvcnQgeyBTZW1pZ3JvdXAgfSBmcm9tICcuL1NlbWlncm91cCdcblxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gbW9kZWxcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuLyoqXG4gKiBAY2F0ZWdvcnkgdHlwZSBjbGFzc2VzXG4gKiBAc2luY2UgMi4wLjBcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBBcHBseTxGPiBleHRlbmRzIEZ1bmN0b3I8Rj4ge1xuICByZWFkb25seSBhcDogPEEsIEI+KGZhYjogSEtUPEYsIChhOiBBKSA9PiBCPiwgZmE6IEhLVDxGLCBBPikgPT4gSEtUPEYsIEI+XG59XG5cbi8qKlxuICogQGNhdGVnb3J5IHR5cGUgY2xhc3Nlc1xuICogQHNpbmNlIDIuMC4wXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQXBwbHkxPEYgZXh0ZW5kcyBVUklTPiBleHRlbmRzIEZ1bmN0b3IxPEY+IHtcbiAgcmVhZG9ubHkgYXA6IDxBLCBCPihmYWI6IEtpbmQ8RiwgKGE6IEEpID0+IEI+LCBmYTogS2luZDxGLCBBPikgPT4gS2luZDxGLCBCPlxufVxuXG4vKipcbiAqIEBjYXRlZ29yeSB0eXBlIGNsYXNzZXNcbiAqIEBzaW5jZSAyLjAuMFxuICovXG5leHBvcnQgaW50ZXJmYWNlIEFwcGx5MjxGIGV4dGVuZHMgVVJJUzI+IGV4dGVuZHMgRnVuY3RvcjI8Rj4ge1xuICByZWFkb25seSBhcDogPEUsIEEsIEI+KGZhYjogS2luZDI8RiwgRSwgKGE6IEEpID0+IEI+LCBmYTogS2luZDI8RiwgRSwgQT4pID0+IEtpbmQyPEYsIEUsIEI+XG59XG5cbi8qKlxuICogQGNhdGVnb3J5IHR5cGUgY2xhc3Nlc1xuICogQHNpbmNlIDIuMC4wXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQXBwbHkyQzxGIGV4dGVuZHMgVVJJUzIsIEU+IGV4dGVuZHMgRnVuY3RvcjJDPEYsIEU+IHtcbiAgcmVhZG9ubHkgYXA6IDxBLCBCPihmYWI6IEtpbmQyPEYsIEUsIChhOiBBKSA9PiBCPiwgZmE6IEtpbmQyPEYsIEUsIEE+KSA9PiBLaW5kMjxGLCBFLCBCPlxufVxuXG4vKipcbiAqIEBjYXRlZ29yeSB0eXBlIGNsYXNzZXNcbiAqIEBzaW5jZSAyLjAuMFxuICovXG5leHBvcnQgaW50ZXJmYWNlIEFwcGx5MzxGIGV4dGVuZHMgVVJJUzM+IGV4dGVuZHMgRnVuY3RvcjM8Rj4ge1xuICByZWFkb25seSBhcDogPFIsIEUsIEEsIEI+KGZhYjogS2luZDM8RiwgUiwgRSwgKGE6IEEpID0+IEI+LCBmYTogS2luZDM8RiwgUiwgRSwgQT4pID0+IEtpbmQzPEYsIFIsIEUsIEI+XG59XG5cbi8qKlxuICogQGNhdGVnb3J5IHR5cGUgY2xhc3Nlc1xuICogQHNpbmNlIDIuMi4wXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQXBwbHkzQzxGIGV4dGVuZHMgVVJJUzMsIEU+IGV4dGVuZHMgRnVuY3RvcjNDPEYsIEU+IHtcbiAgcmVhZG9ubHkgYXA6IDxSLCBBLCBCPihmYWI6IEtpbmQzPEYsIFIsIEUsIChhOiBBKSA9PiBCPiwgZmE6IEtpbmQzPEYsIFIsIEUsIEE+KSA9PiBLaW5kMzxGLCBSLCBFLCBCPlxufVxuXG4vKipcbiAqIEBjYXRlZ29yeSB0eXBlIGNsYXNzZXNcbiAqIEBzaW5jZSAyLjAuMFxuICovXG5leHBvcnQgaW50ZXJmYWNlIEFwcGx5NDxGIGV4dGVuZHMgVVJJUzQ+IGV4dGVuZHMgRnVuY3RvcjQ8Rj4ge1xuICByZWFkb25seSBhcDogPFMsIFIsIEUsIEEsIEI+KGZhYjogS2luZDQ8RiwgUywgUiwgRSwgKGE6IEEpID0+IEI+LCBmYTogS2luZDQ8RiwgUywgUiwgRSwgQT4pID0+IEtpbmQ0PEYsIFMsIFIsIEUsIEI+XG59XG5cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIGNvbWJpbmF0b3JzXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbi8qKlxuICogYGFwYCBjb21wb3NpdGlvbi5cbiAqXG4gKiBAY2F0ZWdvcnkgY29tYmluYXRvcnNcbiAqIEBzaW5jZSAyLjEwLjBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFwPEYgZXh0ZW5kcyBVUklTMiwgRyBleHRlbmRzIFVSSVMyLCBFPihcbiAgRjogQXBwbHkyPEY+LFxuICBHOiBBcHBseTJDPEcsIEU+XG4pOiA8RkUsIEE+KFxuICBmYTogS2luZDI8RiwgRkUsIEtpbmQyPEcsIEUsIEE+PlxuKSA9PiA8Qj4oZmFiOiBLaW5kMjxGLCBGRSwgS2luZDI8RywgRSwgKGE6IEEpID0+IEI+PikgPT4gS2luZDI8RiwgRkUsIEtpbmQyPEcsIEUsIEI+PlxuZXhwb3J0IGZ1bmN0aW9uIGFwPEYgZXh0ZW5kcyBVUklTLCBHIGV4dGVuZHMgVVJJUzIsIEU+KFxuICBGOiBBcHBseTE8Rj4sXG4gIEc6IEFwcGx5MkM8RywgRT5cbik6IDxBPihmYTogS2luZDxGLCBLaW5kMjxHLCBFLCBBPj4pID0+IDxCPihmYWI6IEtpbmQ8RiwgS2luZDI8RywgRSwgKGE6IEEpID0+IEI+PikgPT4gS2luZDxGLCBLaW5kMjxHLCBFLCBCPj5cbmV4cG9ydCBmdW5jdGlvbiBhcDxGLCBHIGV4dGVuZHMgVVJJUzI+KFxuICBGOiBBcHBseTxGPixcbiAgRzogQXBwbHkyPEc+XG4pOiA8RSwgQT4oZmE6IEhLVDxGLCBLaW5kMjxHLCBFLCBBPj4pID0+IDxCPihmYWI6IEhLVDxGLCBLaW5kMjxHLCBFLCAoYTogQSkgPT4gQj4+KSA9PiBIS1Q8RiwgS2luZDI8RywgRSwgQj4+XG5leHBvcnQgZnVuY3Rpb24gYXA8RiwgRyBleHRlbmRzIFVSSVMyLCBFPihcbiAgRjogQXBwbHk8Rj4sXG4gIEc6IEFwcGx5MkM8RywgRT5cbik6IDxBPihmYTogSEtUPEYsIEtpbmQyPEcsIEUsIEE+PikgPT4gPEI+KGZhYjogSEtUPEYsIEtpbmQyPEcsIEUsIChhOiBBKSA9PiBCPj4pID0+IEhLVDxGLCBLaW5kMjxHLCBFLCBCPj5cbmV4cG9ydCBmdW5jdGlvbiBhcDxGLCBHIGV4dGVuZHMgVVJJUz4oXG4gIEY6IEFwcGx5PEY+LFxuICBHOiBBcHBseTE8Rz5cbik6IDxBPihmYTogSEtUPEYsIEtpbmQ8RywgQT4+KSA9PiA8Qj4oZmFiOiBIS1Q8RiwgS2luZDxHLCAoYTogQSkgPT4gQj4+KSA9PiBIS1Q8RiwgS2luZDxHLCBCPj5cbmV4cG9ydCBmdW5jdGlvbiBhcDxGLCBHPihcbiAgRjogQXBwbHk8Rj4sXG4gIEc6IEFwcGx5PEc+XG4pOiA8QT4oZmE6IEhLVDxGLCBIS1Q8RywgQT4+KSA9PiA8Qj4oZmFiOiBIS1Q8RiwgSEtUPEcsIChhOiBBKSA9PiBCPj4pID0+IEhLVDxGLCBIS1Q8RywgQj4+XG5leHBvcnQgZnVuY3Rpb24gYXA8RiwgRz4oXG4gIEY6IEFwcGx5PEY+LFxuICBHOiBBcHBseTxHPlxuKTogPEE+KGZhOiBIS1Q8RiwgSEtUPEcsIEE+PikgPT4gPEI+KGZhYjogSEtUPEYsIEhLVDxHLCAoYTogQSkgPT4gQj4+KSA9PiBIS1Q8RiwgSEtUPEcsIEI+PiB7XG4gIHJldHVybiA8QT4oZmE6IEhLVDxGLCBIS1Q8RywgQT4+KSA9PiA8Qj4oZmFiOiBIS1Q8RiwgSEtUPEcsIChhOiBBKSA9PiBCPj4pOiBIS1Q8RiwgSEtUPEcsIEI+PiA9PlxuICAgIEYuYXAoXG4gICAgICBGLm1hcChmYWIsIChnYWIpID0+IChnYTogSEtUPEcsIEE+KSA9PiBHLmFwKGdhYiwgZ2EpKSxcbiAgICAgIGZhXG4gICAgKVxufVxuXG4vKipcbiAqIEBjYXRlZ29yeSBjb21iaW5hdG9yc1xuICogQHNpbmNlIDIuMTAuMFxuICovXG5leHBvcnQgZnVuY3Rpb24gYXBGaXJzdDxGIGV4dGVuZHMgVVJJUzQ+KFxuICBBOiBBcHBseTQ8Rj5cbik6IDxTLCBSLCBFLCBCPihzZWNvbmQ6IEtpbmQ0PEYsIFMsIFIsIEUsIEI+KSA9PiA8QT4oZmlyc3Q6IEtpbmQ0PEYsIFMsIFIsIEUsIEE+KSA9PiBLaW5kNDxGLCBTLCBSLCBFLCBBPlxuZXhwb3J0IGZ1bmN0aW9uIGFwRmlyc3Q8RiBleHRlbmRzIFVSSVMzPihcbiAgQTogQXBwbHkzPEY+XG4pOiA8UiwgRSwgQj4oc2Vjb25kOiBLaW5kMzxGLCBSLCBFLCBCPikgPT4gPEE+KGZpcnN0OiBLaW5kMzxGLCBSLCBFLCBBPikgPT4gS2luZDM8RiwgUiwgRSwgQT5cbmV4cG9ydCBmdW5jdGlvbiBhcEZpcnN0PEYgZXh0ZW5kcyBVUklTMywgRT4oXG4gIEE6IEFwcGx5M0M8RiwgRT5cbik6IDxSLCBCPihzZWNvbmQ6IEtpbmQzPEYsIFIsIEUsIEI+KSA9PiA8QT4oZmlyc3Q6IEtpbmQzPEYsIFIsIEUsIEE+KSA9PiBLaW5kMzxGLCBSLCBFLCBBPlxuZXhwb3J0IGZ1bmN0aW9uIGFwRmlyc3Q8RiBleHRlbmRzIFVSSVMyPihcbiAgQTogQXBwbHkyPEY+XG4pOiA8RSwgQj4oc2Vjb25kOiBLaW5kMjxGLCBFLCBCPikgPT4gPEE+KGZpcnN0OiBLaW5kMjxGLCBFLCBBPikgPT4gS2luZDI8RiwgRSwgQT5cbmV4cG9ydCBmdW5jdGlvbiBhcEZpcnN0PEYgZXh0ZW5kcyBVUklTMiwgRT4oXG4gIEE6IEFwcGx5MkM8RiwgRT5cbik6IDxCPihzZWNvbmQ6IEtpbmQyPEYsIEUsIEI+KSA9PiA8QT4oZmlyc3Q6IEtpbmQyPEYsIEUsIEE+KSA9PiBLaW5kMjxGLCBFLCBBPlxuZXhwb3J0IGZ1bmN0aW9uIGFwRmlyc3Q8RiBleHRlbmRzIFVSSVM+KEE6IEFwcGx5MTxGPik6IDxCPihzZWNvbmQ6IEtpbmQ8RiwgQj4pID0+IDxBPihmaXJzdDogS2luZDxGLCBBPikgPT4gS2luZDxGLCBBPlxuZXhwb3J0IGZ1bmN0aW9uIGFwRmlyc3Q8Rj4oQTogQXBwbHk8Rj4pOiA8Qj4oc2Vjb25kOiBIS1Q8RiwgQj4pID0+IDxBPihmaXJzdDogSEtUPEYsIEE+KSA9PiBIS1Q8RiwgQT5cbmV4cG9ydCBmdW5jdGlvbiBhcEZpcnN0PEY+KEE6IEFwcGx5PEY+KTogPEI+KHNlY29uZDogSEtUPEYsIEI+KSA9PiA8QT4oZmlyc3Q6IEhLVDxGLCBBPikgPT4gSEtUPEYsIEE+IHtcbiAgcmV0dXJuIChzZWNvbmQpID0+IChmaXJzdCkgPT5cbiAgICBBLmFwKFxuICAgICAgQS5tYXAoZmlyc3QsIChhKSA9PiAoKSA9PiBhKSxcbiAgICAgIHNlY29uZFxuICAgIClcbn1cblxuLyoqXG4gKiBAY2F0ZWdvcnkgY29tYmluYXRvcnNcbiAqIEBzaW5jZSAyLjEwLjBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFwU2Vjb25kPEYgZXh0ZW5kcyBVUklTND4oXG4gIEE6IEFwcGx5NDxGPlxuKTogPFMsIFIsIEUsIEI+KHNlY29uZDogS2luZDQ8RiwgUywgUiwgRSwgQj4pID0+IDxBPihmaXJzdDogS2luZDQ8RiwgUywgUiwgRSwgQT4pID0+IEtpbmQ0PEYsIFMsIFIsIEUsIEI+XG5leHBvcnQgZnVuY3Rpb24gYXBTZWNvbmQ8RiBleHRlbmRzIFVSSVMzPihcbiAgQTogQXBwbHkzPEY+XG4pOiA8UiwgRSwgQj4oc2Vjb25kOiBLaW5kMzxGLCBSLCBFLCBCPikgPT4gPEE+KGZpcnN0OiBLaW5kMzxGLCBSLCBFLCBBPikgPT4gS2luZDM8RiwgUiwgRSwgQj5cbmV4cG9ydCBmdW5jdGlvbiBhcFNlY29uZDxGIGV4dGVuZHMgVVJJUzMsIEU+KFxuICBBOiBBcHBseTNDPEYsIEU+XG4pOiA8UiwgQj4oc2Vjb25kOiBLaW5kMzxGLCBSLCBFLCBCPikgPT4gPEE+KGZpcnN0OiBLaW5kMzxGLCBSLCBFLCBBPikgPT4gS2luZDM8RiwgUiwgRSwgQj5cbmV4cG9ydCBmdW5jdGlvbiBhcFNlY29uZDxGIGV4dGVuZHMgVVJJUzI+KFxuICBBOiBBcHBseTI8Rj5cbik6IDxFLCBCPihzZWNvbmQ6IEtpbmQyPEYsIEUsIEI+KSA9PiA8QT4oZmlyc3Q6IEtpbmQyPEYsIEUsIEE+KSA9PiBLaW5kMjxGLCBFLCBCPlxuZXhwb3J0IGZ1bmN0aW9uIGFwU2Vjb25kPEYgZXh0ZW5kcyBVUklTMiwgRT4oXG4gIEE6IEFwcGx5MkM8RiwgRT5cbik6IDxCPihzZWNvbmQ6IEtpbmQyPEYsIEUsIEI+KSA9PiA8QT4oZmlyc3Q6IEtpbmQyPEYsIEUsIEE+KSA9PiBLaW5kMjxGLCBFLCBCPlxuZXhwb3J0IGZ1bmN0aW9uIGFwU2Vjb25kPEYgZXh0ZW5kcyBVUklTPihBOiBBcHBseTE8Rj4pOiA8Qj4oc2Vjb25kOiBLaW5kPEYsIEI+KSA9PiA8QT4oZmlyc3Q6IEtpbmQ8RiwgQT4pID0+IEtpbmQ8RiwgQj5cbmV4cG9ydCBmdW5jdGlvbiBhcFNlY29uZDxGPihBOiBBcHBseTxGPik6IDxCPihzZWNvbmQ6IEhLVDxGLCBCPikgPT4gPEE+KGZpcnN0OiBIS1Q8RiwgQT4pID0+IEhLVDxGLCBCPlxuZXhwb3J0IGZ1bmN0aW9uIGFwU2Vjb25kPEY+KEE6IEFwcGx5PEY+KTogPEI+KHNlY29uZDogSEtUPEYsIEI+KSA9PiA8QT4oZmlyc3Q6IEhLVDxGLCBBPikgPT4gSEtUPEYsIEI+IHtcbiAgcmV0dXJuIDxCPihzZWNvbmQ6IEhLVDxGLCBCPikgPT4gKGZpcnN0KSA9PlxuICAgIEEuYXAoXG4gICAgICBBLm1hcChmaXJzdCwgKCkgPT4gKGI6IEIpID0+IGIpLFxuICAgICAgc2Vjb25kXG4gICAgKVxufVxuXG4vKipcbiAqIEBjYXRlZ29yeSBjb21iaW5hdG9yc1xuICogQHNpbmNlIDIuMTAuMFxuICovXG5leHBvcnQgZnVuY3Rpb24gYXBTPEYgZXh0ZW5kcyBVUklTND4oXG4gIEY6IEFwcGx5NDxGPlxuKTogPE4gZXh0ZW5kcyBzdHJpbmcsIEEsIFMsIFIsIEUsIEI+KFxuICBuYW1lOiBFeGNsdWRlPE4sIGtleW9mIEE+LFxuICBmYjogS2luZDQ8RiwgUywgUiwgRSwgQj5cbikgPT4gKGZhOiBLaW5kNDxGLCBTLCBSLCBFLCBBPikgPT4gS2luZDQ8RiwgUywgUiwgRSwgeyByZWFkb25seSBbSyBpbiBrZXlvZiBBIHwgTl06IEsgZXh0ZW5kcyBrZXlvZiBBID8gQVtLXSA6IEIgfT5cbmV4cG9ydCBmdW5jdGlvbiBhcFM8RiBleHRlbmRzIFVSSVMzPihcbiAgRjogQXBwbHkzPEY+XG4pOiA8TiBleHRlbmRzIHN0cmluZywgQSwgUiwgRSwgQj4oXG4gIG5hbWU6IEV4Y2x1ZGU8Tiwga2V5b2YgQT4sXG4gIGZiOiBLaW5kMzxGLCBSLCBFLCBCPlxuKSA9PiAoZmE6IEtpbmQzPEYsIFIsIEUsIEE+KSA9PiBLaW5kMzxGLCBSLCBFLCB7IHJlYWRvbmx5IFtLIGluIGtleW9mIEEgfCBOXTogSyBleHRlbmRzIGtleW9mIEEgPyBBW0tdIDogQiB9PlxuZXhwb3J0IGZ1bmN0aW9uIGFwUzxGIGV4dGVuZHMgVVJJUzMsIEU+KFxuICBGOiBBcHBseTNDPEYsIEU+XG4pOiA8TiBleHRlbmRzIHN0cmluZywgQSwgUiwgQj4oXG4gIG5hbWU6IEV4Y2x1ZGU8Tiwga2V5b2YgQT4sXG4gIGZiOiBLaW5kMzxGLCBSLCBFLCBCPlxuKSA9PiAoZmE6IEtpbmQzPEYsIFIsIEUsIEE+KSA9PiBLaW5kMzxGLCBSLCBFLCB7IHJlYWRvbmx5IFtLIGluIGtleW9mIEEgfCBOXTogSyBleHRlbmRzIGtleW9mIEEgPyBBW0tdIDogQiB9PlxuZXhwb3J0IGZ1bmN0aW9uIGFwUzxGIGV4dGVuZHMgVVJJUzI+KFxuICBGOiBBcHBseTI8Rj5cbik6IDxOIGV4dGVuZHMgc3RyaW5nLCBBLCBFLCBCPihcbiAgbmFtZTogRXhjbHVkZTxOLCBrZXlvZiBBPixcbiAgZmI6IEtpbmQyPEYsIEUsIEI+XG4pID0+IChmYTogS2luZDI8RiwgRSwgQT4pID0+IEtpbmQyPEYsIEUsIHsgcmVhZG9ubHkgW0sgaW4ga2V5b2YgQSB8IE5dOiBLIGV4dGVuZHMga2V5b2YgQSA/IEFbS10gOiBCIH0+XG5leHBvcnQgZnVuY3Rpb24gYXBTPEYgZXh0ZW5kcyBVUklTMiwgRT4oXG4gIEY6IEFwcGx5MkM8RiwgRT5cbik6IDxOIGV4dGVuZHMgc3RyaW5nLCBBLCBCPihcbiAgbmFtZTogRXhjbHVkZTxOLCBrZXlvZiBBPixcbiAgZmI6IEtpbmQyPEYsIEUsIEI+XG4pID0+IChmYTogS2luZDI8RiwgRSwgQT4pID0+IEtpbmQyPEYsIEUsIHsgcmVhZG9ubHkgW0sgaW4ga2V5b2YgQSB8IE5dOiBLIGV4dGVuZHMga2V5b2YgQSA/IEFbS10gOiBCIH0+XG5leHBvcnQgZnVuY3Rpb24gYXBTPEYgZXh0ZW5kcyBVUklTPihcbiAgRjogQXBwbHkxPEY+XG4pOiA8TiBleHRlbmRzIHN0cmluZywgQSwgQj4oXG4gIG5hbWU6IEV4Y2x1ZGU8Tiwga2V5b2YgQT4sXG4gIGZiOiBLaW5kPEYsIEI+XG4pID0+IChmYTogS2luZDxGLCBBPikgPT4gS2luZDxGLCB7IHJlYWRvbmx5IFtLIGluIGtleW9mIEEgfCBOXTogSyBleHRlbmRzIGtleW9mIEEgPyBBW0tdIDogQiB9PlxuZXhwb3J0IGZ1bmN0aW9uIGFwUzxGPihcbiAgRjogQXBwbHk8Rj5cbik6IDxOIGV4dGVuZHMgc3RyaW5nLCBBLCBCPihcbiAgbmFtZTogRXhjbHVkZTxOLCBrZXlvZiBBPixcbiAgZmI6IEhLVDxGLCBCPlxuKSA9PiAoZmE6IEhLVDxGLCBBPikgPT4gSEtUPEYsIHsgcmVhZG9ubHkgW0sgaW4ga2V5b2YgQSB8IE5dOiBLIGV4dGVuZHMga2V5b2YgQSA/IEFbS10gOiBCIH0+XG5leHBvcnQgZnVuY3Rpb24gYXBTPEY+KFxuICBGOiBBcHBseTxGPlxuKTogPE4gZXh0ZW5kcyBzdHJpbmcsIEEsIEI+KFxuICBuYW1lOiBFeGNsdWRlPE4sIGtleW9mIEE+LFxuICBmYjogSEtUPEYsIEI+XG4pID0+IChmYTogSEtUPEYsIEE+KSA9PiBIS1Q8RiwgeyByZWFkb25seSBbSyBpbiBrZXlvZiBBIHwgTl06IEsgZXh0ZW5kcyBrZXlvZiBBID8gQVtLXSA6IEIgfT4ge1xuICByZXR1cm4gPEI+KG5hbWU6IHN0cmluZywgZmI6IEhLVDxGLCBCPikgPT4gKGZhKSA9PlxuICAgIEYuYXAoXG4gICAgICBGLm1hcChmYSwgKGEpID0+IChiOiBCKSA9PiBPYmplY3QuYXNzaWduKHt9LCBhLCB7IFtuYW1lXTogYiB9KSBhcyBhbnkpLFxuICAgICAgZmJcbiAgICApXG59XG5cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIHV0aWxzXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbi8qKlxuICogTGlmdCBhIHNlbWlncm91cCBpbnRvICdGJywgdGhlIGlubmVyIHZhbHVlcyBhcmUgY29uY2F0ZW5hdGVkIHVzaW5nIHRoZSBwcm92aWRlZCBgU2VtaWdyb3VwYC5cbiAqXG4gKiBAc2luY2UgMi4xMC4wXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRBcHBseVNlbWlncm91cDxGIGV4dGVuZHMgVVJJUzQ+KFxuICBGOiBBcHBseTQ8Rj5cbik6IDxBLCBTLCBSLCBFPihTOiBTZW1pZ3JvdXA8QT4pID0+IFNlbWlncm91cDxLaW5kNDxGLCBTLCBSLCBFLCBBPj5cbmV4cG9ydCBmdW5jdGlvbiBnZXRBcHBseVNlbWlncm91cDxGIGV4dGVuZHMgVVJJUzM+KFxuICBGOiBBcHBseTM8Rj5cbik6IDxBLCBSLCBFPihTOiBTZW1pZ3JvdXA8QT4pID0+IFNlbWlncm91cDxLaW5kMzxGLCBSLCBFLCBBPj5cbmV4cG9ydCBmdW5jdGlvbiBnZXRBcHBseVNlbWlncm91cDxGIGV4dGVuZHMgVVJJUzMsIEU+KFxuICBGOiBBcHBseTNDPEYsIEU+XG4pOiA8QSwgUj4oUzogU2VtaWdyb3VwPEE+KSA9PiBTZW1pZ3JvdXA8S2luZDM8RiwgUiwgRSwgQT4+XG5leHBvcnQgZnVuY3Rpb24gZ2V0QXBwbHlTZW1pZ3JvdXA8RiBleHRlbmRzIFVSSVMyPihGOiBBcHBseTI8Rj4pOiA8QSwgRT4oUzogU2VtaWdyb3VwPEE+KSA9PiBTZW1pZ3JvdXA8S2luZDI8RiwgRSwgQT4+XG5leHBvcnQgZnVuY3Rpb24gZ2V0QXBwbHlTZW1pZ3JvdXA8RiBleHRlbmRzIFVSSVMyLCBFPihcbiAgRjogQXBwbHkyQzxGLCBFPlxuKTogPEE+KFM6IFNlbWlncm91cDxBPikgPT4gU2VtaWdyb3VwPEtpbmQyPEYsIEUsIEE+PlxuZXhwb3J0IGZ1bmN0aW9uIGdldEFwcGx5U2VtaWdyb3VwPEYgZXh0ZW5kcyBVUklTPihGOiBBcHBseTE8Rj4pOiA8QT4oUzogU2VtaWdyb3VwPEE+KSA9PiBTZW1pZ3JvdXA8S2luZDxGLCBBPj5cbmV4cG9ydCBmdW5jdGlvbiBnZXRBcHBseVNlbWlncm91cDxGPihGOiBBcHBseTxGPik6IDxBPihTOiBTZW1pZ3JvdXA8QT4pID0+IFNlbWlncm91cDxIS1Q8RiwgQT4+XG5leHBvcnQgZnVuY3Rpb24gZ2V0QXBwbHlTZW1pZ3JvdXA8Rj4oRjogQXBwbHk8Rj4pOiA8QT4oUzogU2VtaWdyb3VwPEE+KSA9PiBTZW1pZ3JvdXA8SEtUPEYsIEE+PiB7XG4gIHJldHVybiA8QT4oUzogU2VtaWdyb3VwPEE+KSA9PiAoe1xuICAgIGNvbmNhdDogKGZpcnN0OiBIS1Q8RiwgQT4sIHNlY29uZDogSEtUPEYsIEE+KSA9PlxuICAgICAgRi5hcChcbiAgICAgICAgRi5tYXAoZmlyc3QsICh4OiBBKSA9PiAoeTogQSkgPT4gUy5jb25jYXQoeCwgeSkpLFxuICAgICAgICBzZWNvbmRcbiAgICAgIClcbiAgfSlcbn1cblxuZnVuY3Rpb24gY3VycmllZChmOiBGdW5jdGlvbiwgbjogbnVtYmVyLCBhY2M6IFJlYWRvbmx5QXJyYXk8dW5rbm93bj4pIHtcbiAgcmV0dXJuIGZ1bmN0aW9uICh4OiB1bmtub3duKSB7XG4gICAgY29uc3QgY29tYmluZWQgPSBBcnJheShhY2MubGVuZ3RoICsgMSlcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFjYy5sZW5ndGg7IGkrKykge1xuICAgICAgY29tYmluZWRbaV0gPSBhY2NbaV1cbiAgICB9XG4gICAgY29tYmluZWRbYWNjLmxlbmd0aF0gPSB4XG4gICAgcmV0dXJuIG4gPT09IDAgPyBmLmFwcGx5KG51bGwsIGNvbWJpbmVkKSA6IGN1cnJpZWQoZiwgbiAtIDEsIGNvbWJpbmVkKVxuICB9XG59XG5cbmNvbnN0IHR1cGxlQ29uc3RydWN0b3JzOiBSZWNvcmQ8bnVtYmVyLCAoYTogdW5rbm93bikgPT4gYW55PiA9IHtcbiAgMTogKGEpID0+IFthXSxcbiAgMjogKGEpID0+IChiOiBhbnkpID0+IFthLCBiXSxcbiAgMzogKGEpID0+IChiOiBhbnkpID0+IChjOiBhbnkpID0+IFthLCBiLCBjXSxcbiAgNDogKGEpID0+IChiOiBhbnkpID0+IChjOiBhbnkpID0+IChkOiBhbnkpID0+IFthLCBiLCBjLCBkXSxcbiAgNTogKGEpID0+IChiOiBhbnkpID0+IChjOiBhbnkpID0+IChkOiBhbnkpID0+IChlOiBhbnkpID0+IFthLCBiLCBjLCBkLCBlXVxufVxuXG5mdW5jdGlvbiBnZXRUdXBsZUNvbnN0cnVjdG9yKGxlbjogbnVtYmVyKTogKGE6IHVua25vd24pID0+IGFueSB7XG4gIGlmICghdHVwbGVDb25zdHJ1Y3RvcnMuaGFzT3duUHJvcGVydHkobGVuKSkge1xuICAgIHR1cGxlQ29uc3RydWN0b3JzW2xlbl0gPSBjdXJyaWVkKHR1cGxlLCBsZW4gLSAxLCBbXSlcbiAgfVxuICByZXR1cm4gdHVwbGVDb25zdHJ1Y3RvcnNbbGVuXVxufVxuXG4vKipcbiAqIFR1cGxlIHNlcXVlbmNpbmcsIGkuZS4sIHRha2UgYSB0dXBsZSBvZiBtb25hZGljIGFjdGlvbnMgYW5kIGRvZXMgdGhlbSBmcm9tIGxlZnQtdG8tcmlnaHQsIHJldHVybmluZyB0aGUgcmVzdWx0aW5nIHR1cGxlLlxuICpcbiAqIEBleGFtcGxlXG4gKiBpbXBvcnQgeyBzZXF1ZW5jZVQgfSBmcm9tICdmcC10cy9BcHBseSdcbiAqIGltcG9ydCAqIGFzIE8gZnJvbSAnZnAtdHMvT3B0aW9uJ1xuICpcbiAqIGNvbnN0IHNlcXVlbmNlVE9wdGlvbiA9IHNlcXVlbmNlVChPLkFwcGx5KVxuICogYXNzZXJ0LmRlZXBTdHJpY3RFcXVhbChzZXF1ZW5jZVRPcHRpb24oTy5zb21lKDEpKSwgTy5zb21lKFsxXSkpXG4gKiBhc3NlcnQuZGVlcFN0cmljdEVxdWFsKHNlcXVlbmNlVE9wdGlvbihPLnNvbWUoMSksIE8uc29tZSgnMicpKSwgTy5zb21lKFsxLCAnMiddKSlcbiAqIGFzc2VydC5kZWVwU3RyaWN0RXF1YWwoc2VxdWVuY2VUT3B0aW9uKE8uc29tZSgxKSwgTy5zb21lKCcyJyksIE8ubm9uZSksIE8ubm9uZSlcbiAqXG4gKiBAc2luY2UgMi4wLjBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNlcXVlbmNlVDxGIGV4dGVuZHMgVVJJUzQ+KFxuICBGOiBBcHBseTQ8Rj5cbik6IDxTLCBSLCBFLCBUIGV4dGVuZHMgQXJyYXk8S2luZDQ8RiwgUywgUiwgRSwgYW55Pj4+KFxuICAuLi50OiBUICYgeyByZWFkb25seSAwOiBLaW5kNDxGLCBTLCBSLCBFLCBhbnk+IH1cbikgPT4gS2luZDQ8RiwgUywgUiwgRSwgeyBbSyBpbiBrZXlvZiBUXTogW1RbS11dIGV4dGVuZHMgW0tpbmQ0PEYsIFMsIFIsIEUsIGluZmVyIEE+XSA/IEEgOiBuZXZlciB9PlxuZXhwb3J0IGZ1bmN0aW9uIHNlcXVlbmNlVDxGIGV4dGVuZHMgVVJJUzM+KFxuICBGOiBBcHBseTM8Rj5cbik6IDxSLCBFLCBUIGV4dGVuZHMgQXJyYXk8S2luZDM8RiwgUiwgRSwgYW55Pj4+KFxuICAuLi50OiBUICYgeyByZWFkb25seSAwOiBLaW5kMzxGLCBSLCBFLCBhbnk+IH1cbikgPT4gS2luZDM8RiwgUiwgRSwgeyBbSyBpbiBrZXlvZiBUXTogW1RbS11dIGV4dGVuZHMgW0tpbmQzPEYsIFIsIEUsIGluZmVyIEE+XSA/IEEgOiBuZXZlciB9PlxuZXhwb3J0IGZ1bmN0aW9uIHNlcXVlbmNlVDxGIGV4dGVuZHMgVVJJUzMsIEU+KFxuICBGOiBBcHBseTNDPEYsIEU+XG4pOiA8UiwgVCBleHRlbmRzIEFycmF5PEtpbmQzPEYsIFIsIEUsIGFueT4+PihcbiAgLi4udDogVCAmIHsgcmVhZG9ubHkgMDogS2luZDM8RiwgUiwgRSwgYW55PiB9XG4pID0+IEtpbmQzPEYsIFIsIEUsIHsgW0sgaW4ga2V5b2YgVF06IFtUW0tdXSBleHRlbmRzIFtLaW5kMzxGLCBSLCBFLCBpbmZlciBBPl0gPyBBIDogbmV2ZXIgfT5cbmV4cG9ydCBmdW5jdGlvbiBzZXF1ZW5jZVQ8RiBleHRlbmRzIFVSSVMyPihcbiAgRjogQXBwbHkyPEY+XG4pOiA8RSwgVCBleHRlbmRzIEFycmF5PEtpbmQyPEYsIEUsIGFueT4+PihcbiAgLi4udDogVCAmIHsgcmVhZG9ubHkgMDogS2luZDI8RiwgRSwgYW55PiB9XG4pID0+IEtpbmQyPEYsIEUsIHsgW0sgaW4ga2V5b2YgVF06IFtUW0tdXSBleHRlbmRzIFtLaW5kMjxGLCBFLCBpbmZlciBBPl0gPyBBIDogbmV2ZXIgfT5cbmV4cG9ydCBmdW5jdGlvbiBzZXF1ZW5jZVQ8RiBleHRlbmRzIFVSSVMyLCBFPihcbiAgRjogQXBwbHkyQzxGLCBFPlxuKTogPFQgZXh0ZW5kcyBBcnJheTxLaW5kMjxGLCBFLCBhbnk+Pj4oXG4gIC4uLnQ6IFQgJiB7IHJlYWRvbmx5IDA6IEtpbmQyPEYsIEUsIGFueT4gfVxuKSA9PiBLaW5kMjxGLCBFLCB7IFtLIGluIGtleW9mIFRdOiBbVFtLXV0gZXh0ZW5kcyBbS2luZDI8RiwgRSwgaW5mZXIgQT5dID8gQSA6IG5ldmVyIH0+XG5leHBvcnQgZnVuY3Rpb24gc2VxdWVuY2VUPEYgZXh0ZW5kcyBVUklTPihcbiAgRjogQXBwbHkxPEY+XG4pOiA8VCBleHRlbmRzIEFycmF5PEtpbmQ8RiwgYW55Pj4+KFxuICAuLi50OiBUICYgeyByZWFkb25seSAwOiBLaW5kPEYsIGFueT4gfVxuKSA9PiBLaW5kPEYsIHsgW0sgaW4ga2V5b2YgVF06IFtUW0tdXSBleHRlbmRzIFtLaW5kPEYsIGluZmVyIEE+XSA/IEEgOiBuZXZlciB9PlxuZXhwb3J0IGZ1bmN0aW9uIHNlcXVlbmNlVDxGPihcbiAgRjogQXBwbHk8Rj5cbik6IDxUIGV4dGVuZHMgQXJyYXk8SEtUPEYsIGFueT4+PihcbiAgLi4udDogVCAmIHsgcmVhZG9ubHkgMDogSEtUPEYsIGFueT4gfVxuKSA9PiBIS1Q8RiwgeyBbSyBpbiBrZXlvZiBUXTogW1RbS11dIGV4dGVuZHMgW0hLVDxGLCBpbmZlciBBPl0gPyBBIDogbmV2ZXIgfT5cbmV4cG9ydCBmdW5jdGlvbiBzZXF1ZW5jZVQ8Rj4oRjogQXBwbHk8Rj4pOiBhbnkge1xuICByZXR1cm4gPEE+KC4uLmFyZ3M6IEFycmF5PEhLVDxGLCBBPj4pID0+IHtcbiAgICBjb25zdCBsZW4gPSBhcmdzLmxlbmd0aFxuICAgIGNvbnN0IGYgPSBnZXRUdXBsZUNvbnN0cnVjdG9yKGxlbilcbiAgICBsZXQgZmFzID0gRi5tYXAoYXJnc1swXSwgZilcbiAgICBmb3IgKGxldCBpID0gMTsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICBmYXMgPSBGLmFwKGZhcywgYXJnc1tpXSlcbiAgICB9XG4gICAgcmV0dXJuIGZhc1xuICB9XG59XG5cbnR5cGUgRW5mb3JjZU5vbkVtcHR5UmVjb3JkPFI+ID0ga2V5b2YgUiBleHRlbmRzIG5ldmVyID8gbmV2ZXIgOiBSXG5cbmZ1bmN0aW9uIGdldFJlY29yZENvbnN0cnVjdG9yKGtleXM6IFJlYWRvbmx5QXJyYXk8c3RyaW5nPikge1xuICBjb25zdCBsZW4gPSBrZXlzLmxlbmd0aFxuICBzd2l0Y2ggKGxlbikge1xuICAgIGNhc2UgMTpcbiAgICAgIHJldHVybiAoYTogYW55KSA9PiAoeyBba2V5c1swXV06IGEgfSlcbiAgICBjYXNlIDI6XG4gICAgICByZXR1cm4gKGE6IGFueSkgPT4gKGI6IGFueSkgPT4gKHsgW2tleXNbMF1dOiBhLCBba2V5c1sxXV06IGIgfSlcbiAgICBjYXNlIDM6XG4gICAgICByZXR1cm4gKGE6IGFueSkgPT4gKGI6IGFueSkgPT4gKGM6IGFueSkgPT4gKHsgW2tleXNbMF1dOiBhLCBba2V5c1sxXV06IGIsIFtrZXlzWzJdXTogYyB9KVxuICAgIGNhc2UgNDpcbiAgICAgIHJldHVybiAoYTogYW55KSA9PiAoYjogYW55KSA9PiAoYzogYW55KSA9PiAoZDogYW55KSA9PiAoe1xuICAgICAgICBba2V5c1swXV06IGEsXG4gICAgICAgIFtrZXlzWzFdXTogYixcbiAgICAgICAgW2tleXNbMl1dOiBjLFxuICAgICAgICBba2V5c1szXV06IGRcbiAgICAgIH0pXG4gICAgY2FzZSA1OlxuICAgICAgcmV0dXJuIChhOiBhbnkpID0+IChiOiBhbnkpID0+IChjOiBhbnkpID0+IChkOiBhbnkpID0+IChlOiBhbnkpID0+ICh7XG4gICAgICAgIFtrZXlzWzBdXTogYSxcbiAgICAgICAgW2tleXNbMV1dOiBiLFxuICAgICAgICBba2V5c1syXV06IGMsXG4gICAgICAgIFtrZXlzWzNdXTogZCxcbiAgICAgICAgW2tleXNbNF1dOiBlXG4gICAgICB9KVxuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gY3VycmllZChcbiAgICAgICAgKC4uLmFyZ3M6IFJlYWRvbmx5QXJyYXk8dW5rbm93bj4pID0+IHtcbiAgICAgICAgICBjb25zdCByOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4gICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgcltrZXlzW2ldXSA9IGFyZ3NbaV1cbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHJcbiAgICAgICAgfSxcbiAgICAgICAgbGVuIC0gMSxcbiAgICAgICAgW11cbiAgICAgIClcbiAgfVxufVxuXG4vKipcbiAqIExpa2UgYEFwcGx5LnNlcXVlbmNlVGAgYnV0IHdvcmtzIHdpdGggc3RydWN0cyBpbnN0ZWFkIG9mIHR1cGxlcy5cbiAqXG4gKiBAZXhhbXBsZVxuICogaW1wb3J0ICogYXMgRSBmcm9tICdmcC10cy9FaXRoZXInXG4gKiBpbXBvcnQgeyBzZXF1ZW5jZVMgfSBmcm9tICdmcC10cy9BcHBseSdcbiAqXG4gKiBjb25zdCBhZG8gPSBzZXF1ZW5jZVMoRS5BcHBseSlcbiAqXG4gKiBhc3NlcnQuZGVlcFN0cmljdEVxdWFsKFxuICogICBhZG8oe1xuICogICAgIGE6IEUucmlnaHQoMSksXG4gKiAgICAgYjogRS5yaWdodCh0cnVlKVxuICogICB9KSxcbiAqICAgRS5yaWdodCh7IGE6IDEsIGI6IHRydWUgfSlcbiAqIClcbiAqIGFzc2VydC5kZWVwU3RyaWN0RXF1YWwoXG4gKiAgIGFkbyh7XG4gKiAgICAgYTogRS5yaWdodCgxKSxcbiAqICAgICBiOiBFLmxlZnQoJ2Vycm9yJylcbiAqICAgfSksXG4gKiAgIEUubGVmdCgnZXJyb3InKVxuICogKVxuICpcbiAqIEBzaW5jZSAyLjAuMFxuICovXG5leHBvcnQgZnVuY3Rpb24gc2VxdWVuY2VTPEYgZXh0ZW5kcyBVUklTND4oXG4gIEY6IEFwcGx5NDxGPlxuKTogPFMsIFIsIEUsIE5FUiBleHRlbmRzIFJlY29yZDxzdHJpbmcsIEtpbmQ0PEYsIFMsIFIsIEUsIGFueT4+PihcbiAgcjogRW5mb3JjZU5vbkVtcHR5UmVjb3JkPE5FUj4gJiBSZWNvcmQ8c3RyaW5nLCBLaW5kNDxGLCBTLCBSLCBFLCBhbnk+PlxuKSA9PiBLaW5kNDxGLCBTLCBSLCBFLCB7IFtLIGluIGtleW9mIE5FUl06IFtORVJbS11dIGV4dGVuZHMgW0tpbmQ0PEYsIGFueSwgYW55LCBhbnksIGluZmVyIEE+XSA/IEEgOiBuZXZlciB9PlxuZXhwb3J0IGZ1bmN0aW9uIHNlcXVlbmNlUzxGIGV4dGVuZHMgVVJJUzM+KFxuICBGOiBBcHBseTM8Rj5cbik6IDxSLCBFLCBORVIgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCBLaW5kMzxGLCBSLCBFLCBhbnk+Pj4oXG4gIHI6IEVuZm9yY2VOb25FbXB0eVJlY29yZDxORVI+ICYgUmVjb3JkPHN0cmluZywgS2luZDM8RiwgUiwgRSwgYW55Pj5cbikgPT4gS2luZDM8RiwgUiwgRSwgeyBbSyBpbiBrZXlvZiBORVJdOiBbTkVSW0tdXSBleHRlbmRzIFtLaW5kMzxGLCBhbnksIGFueSwgaW5mZXIgQT5dID8gQSA6IG5ldmVyIH0+XG5leHBvcnQgZnVuY3Rpb24gc2VxdWVuY2VTPEYgZXh0ZW5kcyBVUklTMywgRT4oXG4gIEY6IEFwcGx5M0M8RiwgRT5cbik6IDxSLCBORVIgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCBLaW5kMzxGLCBSLCBFLCBhbnk+Pj4oXG4gIHI6IEVuZm9yY2VOb25FbXB0eVJlY29yZDxORVI+ICYgUmVjb3JkPHN0cmluZywgS2luZDM8RiwgUiwgRSwgYW55Pj5cbikgPT4gS2luZDM8RiwgUiwgRSwgeyBbSyBpbiBrZXlvZiBORVJdOiBbTkVSW0tdXSBleHRlbmRzIFtLaW5kMzxGLCBhbnksIGFueSwgaW5mZXIgQT5dID8gQSA6IG5ldmVyIH0+XG5leHBvcnQgZnVuY3Rpb24gc2VxdWVuY2VTPEYgZXh0ZW5kcyBVUklTMj4oXG4gIEY6IEFwcGx5MjxGPlxuKTogPEUsIE5FUiBleHRlbmRzIFJlY29yZDxzdHJpbmcsIEtpbmQyPEYsIEUsIGFueT4+PihcbiAgcjogRW5mb3JjZU5vbkVtcHR5UmVjb3JkPE5FUj4gJiBSZWNvcmQ8c3RyaW5nLCBLaW5kMjxGLCBFLCBhbnk+PlxuKSA9PiBLaW5kMjxGLCBFLCB7IFtLIGluIGtleW9mIE5FUl06IFtORVJbS11dIGV4dGVuZHMgW0tpbmQyPEYsIGFueSwgaW5mZXIgQT5dID8gQSA6IG5ldmVyIH0+XG5leHBvcnQgZnVuY3Rpb24gc2VxdWVuY2VTPEYgZXh0ZW5kcyBVUklTMiwgRT4oXG4gIEY6IEFwcGx5MkM8RiwgRT5cbik6IDxORVIgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCBLaW5kMjxGLCBFLCBhbnk+Pj4oXG4gIHI6IEVuZm9yY2VOb25FbXB0eVJlY29yZDxORVI+XG4pID0+IEtpbmQyPEYsIEUsIHsgW0sgaW4ga2V5b2YgTkVSXTogW05FUltLXV0gZXh0ZW5kcyBbS2luZDI8RiwgYW55LCBpbmZlciBBPl0gPyBBIDogbmV2ZXIgfT5cbmV4cG9ydCBmdW5jdGlvbiBzZXF1ZW5jZVM8RiBleHRlbmRzIFVSSVM+KFxuICBGOiBBcHBseTE8Rj5cbik6IDxORVIgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCBLaW5kPEYsIGFueT4+PihcbiAgcjogRW5mb3JjZU5vbkVtcHR5UmVjb3JkPE5FUj5cbikgPT4gS2luZDxGLCB7IFtLIGluIGtleW9mIE5FUl06IFtORVJbS11dIGV4dGVuZHMgW0tpbmQ8RiwgaW5mZXIgQT5dID8gQSA6IG5ldmVyIH0+XG5leHBvcnQgZnVuY3Rpb24gc2VxdWVuY2VTPEY+KFxuICBGOiBBcHBseTxGPlxuKTogPE5FUiBleHRlbmRzIFJlY29yZDxzdHJpbmcsIEhLVDxGLCBhbnk+Pj4oXG4gIHI6IEVuZm9yY2VOb25FbXB0eVJlY29yZDxORVI+XG4pID0+IEhLVDxGLCB7IFtLIGluIGtleW9mIE5FUl06IFtORVJbS11dIGV4dGVuZHMgW0hLVDxGLCBpbmZlciBBPl0gPyBBIDogbmV2ZXIgfT5cbmV4cG9ydCBmdW5jdGlvbiBzZXF1ZW5jZVM8Rj4oRjogQXBwbHk8Rj4pOiAocjogUmVjb3JkPHN0cmluZywgSEtUPEYsIGFueT4+KSA9PiBIS1Q8RiwgUmVjb3JkPHN0cmluZywgYW55Pj4ge1xuICByZXR1cm4gKHIpID0+IHtcbiAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMocilcbiAgICBjb25zdCBsZW4gPSBrZXlzLmxlbmd0aFxuICAgIGNvbnN0IGYgPSBnZXRSZWNvcmRDb25zdHJ1Y3RvcihrZXlzKVxuICAgIGxldCBmciA9IEYubWFwKHJba2V5c1swXV0sIGYpXG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPCBsZW47IGkrKykge1xuICAgICAgZnIgPSBGLmFwKGZyLCByW2tleXNbaV1dKVxuICAgIH1cbiAgICByZXR1cm4gZnJcbiAgfVxufVxuIl19